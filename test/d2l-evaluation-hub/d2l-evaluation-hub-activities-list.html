<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

		<title>d2l-evaluation-hub test</title>

		<script src="../../../@babel/polyfill/browser.js"></script>
		<script src="../../../@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
		<script src="../../../wct-browser-legacy/browser.js"></script>
		<script type="module" src="../../components/d2l-evaluation-hub-activities-list/d2l-evaluation-hub-activities-list.js"></script>
	</head>
	<body>
		<test-fixture id="basic">
			<template strip-whitespace>
				<d2l-evaluation-hub-activities-list href="data/root.json" token="t"></d2l-evaluation-hub-activities-list>
			</template>
		</test-fixture>
		<test-fixture id="loadedFromActivities">
			<template strip-whitespace>
				<d2l-evaluation-hub-activities-list href="data/unassessedActivities.json" token="t"></d2l-evaluation-hub-activities-list>
			</template>
		</test-fixture>

		<script>
			var list;

			function loadAndWait(id, done) {
				list = fixture(id);
				function waitForLoad() {
					if (list._loading) {
						setTimeout(waitForLoad, 250);
					} else {
						done();
					}
				}
				waitForLoad();
			}

			var expectedData = [
				{
					displayName: 'User Name',
					courseName: 'Org Name',
					activityName: 'Assignment Name',
					submissionDate: '2018-02-03T17:00:00.000Z',
					activityLink: 'link to activity'
				}
			];
			var expectedHeaders = [
				'Submitter', 'Activity Name', 'Course Name', 'Submission Date'
			];

			suite('d2l-evaluation-hub-activities-list', function() {
				setup(function(done) {
					loadAndWait('basic', done);
				});
				test('instantiating the element works', function() {
					assert.equal(list.tagName.toLowerCase(), 'd2l-evaluation-hub-activities-list');
				});
				test('attributes are set correctly', function() {
					assert.equal(list.href, 'data/root.json');
					assert.equal(list.token, 't');
				});
				test('headers display correctly', function() {
					var headers = list.shadowRoot.querySelectorAll('d2l-th');
					for (var i = 0; i < expectedHeaders.length; i++) {
						assert.equal(expectedHeaders[i], headers[i].innerHTML);
					}
				});
				test('data is imported correctly', function() {
					assert.equal(list._data.length, expectedData.length);
					assert.deepEqual(list._data, expectedData);
				});
				test('data displays correctly', function() {
					var expected = [
						'User Name', 'Assignment Name', 'Org Name', '2018-02-03T17:00:00.000Z'
					];
					var data = list.shadowRoot.querySelectorAll('d2l-td');
					for (var i = 0; i < expected.length; i++) {
						assert.equal(expected[i], data[i].innerHTML);
					}
				});
			});

			suite('d2l-evaluation-hub-activities-list load direct from activities', function() {
				setup(function(done) {
					loadAndWait('loadedFromActivities', done);
				});
				test('instantiating the element works', function() {
					assert.equal(list.tagName.toLowerCase(), 'd2l-evaluation-hub-activities-list');
				});
				test('data is imported correctly', function() {
					assert.equal(list._data.length, expectedData.length);
					assert.deepEqual(list._data, expectedData);
				});
			});
		</script>
	</body>
</html>
